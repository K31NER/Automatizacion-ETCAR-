<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETCAR - Panel de Administraci√≥n</title>
    <link rel="icon" href="/static/img/logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@heroicons/v2.0.18/24/outline/index.js"></script>
    <style>
        html, body {
            max-width: 100vw;
            overflow-x: hidden;
            scroll-behavior: smooth;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        /* Layout */
        .admin-grid {
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }
        @media (max-width: 1024px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Stats Cards Mobile Behavior */
        @media (max-width: 1024px) {
            #statsCardsContainer {
                transition: all 0.4s ease-in-out;
            }
            
            #statsCardsContainer.mobile-hidden {
                transform: translateY(-20px);
                opacity: 0;
                height: 0;
                margin-bottom: 0;
                overflow: hidden;
            }
            
            /* Better mobile spacing when search is active */
            .search-active #statsCardsContainer {
                transition: all 0.4s ease-in-out;
            }
            
            /* Search results indicator */
            #mobileSearchResults {
                animation: slideDown 0.3s ease-out;
            }
            
            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        }

        /* Mobile Content Spacing */
        @media (max-width: 1024px) {
            .main-content {
                padding-bottom: 140px; /* Increased space for mobile bottom nav */
                min-height: calc(100vh - 140px);
                padding-top: 1rem;
            }
            
            /* Ensure sections have proper spacing on mobile */
            .section-content {
                padding-bottom: 2rem;
            }
            
            /* Mobile forms adjustments */
            .form-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem;
            }
            
            /* Mobile stats cards - simpler layout */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 1rem;
            }
            
            /* Prevent content from being hidden */
            .table-container {
                margin-bottom: 2rem;
            }
            
            /* Improved mobile padding */
            .card-shadow {
                margin-bottom: 1.5rem;
            }
        }

        /* Cards and Containers */
        .card-shadow { 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(229, 231, 235, 0.8);
        }
        .card-hover:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.25);
        }
        .btn-primary:hover { 
            background: linear-gradient(135deg, #059669 0%, #047857 50%, #065f46 100%);
            box-shadow: 0 6px 20px 0 rgba(16, 185, 129, 0.4);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: rgba(16, 185, 129, 0.1);
            color: #047857;
            border: 1px solid rgba(16, 185, 129, 0.3);
            transition: all 0.2s ease;
        }
        .btn-secondary:hover {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
        }

        /* Sidebar */
        #sidebar {
            background: linear-gradient(180deg, #064e3b 0%, #047857 100%);
            backdrop-filter: blur(10px);
        }
        #sidebar .sidebar-logo { 
            filter: brightness(0) invert(1);
            transition: transform 0.2s ease;
        }
        #sidebar .sidebar-logo:hover { transform: scale(1.1); }
        .nav-link {
            transition: all 0.2s ease;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        .nav-link:hover::before { left: 100%; }
        .nav-link.active { 
            background: rgba(255, 255, 255, 0.15);
            color: white !important;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Tables */
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }
        .responsive-table {
            border-collapse: separate;
            border-spacing: 0;
        }
        .responsive-table thead th {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-bottom: 2px solid #e2e8f0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.75rem;
        }
        .responsive-table tbody tr {
            transition: all 0.2s ease;
        }
        .responsive-table tbody tr:hover {
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            transform: scale(1.01);
        }

        @media (max-width: 768px) {
            table.responsive-table thead { display: none; }
            table.responsive-table tbody tr {
                display: block; 
                margin-bottom: 1.5rem; 
                border-radius: 16px;
                border: 1px solid #e5e7eb; 
                background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
                padding: 1.5rem;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-left: 0; /* Fix alignment */
                margin-right: 0; /* Fix alignment */
            }
            table.responsive-table td {
                display: flex; 
                justify-content: space-between; 
                align-items: flex-start;
                padding: 0.75rem 0; 
                border: none; 
                border-bottom: 1px solid #f3f4f6;
                font-size: 0.875rem;
                text-align: left; /* Ensure proper alignment */
            }
            table.responsive-table td:last-child { border-bottom: none; }
            table.responsive-table td::before {
                content: attr(data-label); 
                font-weight: 600; 
                color: #047857;
                min-width: 120px; 
                flex-shrink: 0;
                text-align: left; /* Ensure proper alignment */
            }
            
            /* Better mobile table container */
            .table-container {
                padding: 0;
                margin: 0 -0.5rem; /* Slight negative margin for better spacing */
                border-radius: 12px;
            }
        }

        /* Modal */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; opacity: 0; visibility: hidden; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modal.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: white; 
            padding: 2rem; 
            border-radius: 20px;
            width: 95vw; max-width: 900px; /* ancho grande en desktop */
            max-height: 80vh; overflow-y: auto;
            transform: scale(0.9) translateY(20px); 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .modal.active .modal-content { 
            transform: scale(1) translateY(0); 
        }
        @media (max-width: 1024px) {
            .modal-content {
                width: 90vw;
                max-width: 98vw;
                padding: 1rem;
            }
        }

        /* Sections */
        .section-content { 
            display: none; 
            animation: fadeIn 0.3s ease-in-out;
        }
        .section-content.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Search */
        .search-container {
            position: relative;
            transition: all 0.2s ease;
        }
        .search-container:focus-within {
            transform: scale(1.02);
        }
        .search-container.filtering {
            /* Visual indicator when filtering is active */
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
            border-radius: 12px;
        }
        
        /* Prevent scroll on mobile during search */
        @media (max-width: 768px) {
            .search-mobile input:focus {
                scroll-behavior: auto; /* Disable smooth scroll during search */
            }
        }
        .search-mobile input {
            width: 100%; 
            padding: 1rem 1rem 1rem 3rem; 
            border: 2px solid #e5e7eb;
            border-radius: 12px; 
            font-size: 0.875rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            transition: all 0.2s ease;
        }
        .search-mobile input:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            background: white;
        }
        .search-mobile input.filtering {
            border-color: #10b981;
            background: white;
        }
        .search-mobile .search-icon {
            position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); 
            color: #6b7280;
            transition: color 0.2s ease;
        }
        .search-container:focus-within .search-icon,
        .search-container.filtering .search-icon {
            color: #10b981;
        }

        /* Header */
        .page-header {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(229, 231, 235, 0.5);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
        }

        /* Bottom Navigation */
        .bottom-nav-link {
            transition: all 0.2s ease;
            border-radius: 12px;
            position: relative;
            min-height: 60px; /* Ensure touch targets are large enough */
            touch-action: manipulation; /* Improve touch responsiveness */
        }
        .bottom-nav-link.active { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white !important;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        .bottom-nav-link:active {
            transform: scale(0.95);
        }

        /* Mobile Welcome */
        .mobile-welcome {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1rem;
            margin: -1rem -1rem 1.5rem -1rem;
            border-radius: 0 0 20px 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        @media (min-width: 1024px) {
            .mobile-welcome {
                display: none;
            }
        }

        /* Additional Mobile Improvements */
        @media (max-width: 640px) {
            .mobile-welcome {
                padding: 0.75rem;
                margin: -1rem -1rem 1rem -1rem;
            }
            .mobile-welcome h1 {
                font-size: 1rem;
            }
            .mobile-welcome p {
                font-size: 0.8rem;
            }
            
            /* Better mobile spacing for cards */
            .card-shadow {
                margin-bottom: 1rem;
            }
            
            /* Improved mobile table */
            .table-container {
                margin: 0 -0.25rem; /* Better alignment */
                border-radius: 12px;
                padding: 0.25rem; /* Add slight padding */
            }
            
            /* Mobile form improvements */
            .form-input {
                padding: 0.75rem;
                font-size: 1rem; /* Prevent zoom on iOS */
            }
            
            /* Better mobile content spacing */
            .main-content {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            /* Improve search input on mobile */
            .search-mobile input {
                font-size: 1rem; /* Prevent zoom */
                padding: 0.875rem 1rem 0.875rem 3rem;
            }
        }

        /* Form Enhancements */
        .form-input {
            transition: all 0.2s ease;
            border-radius: 10px;
        }
        .form-input:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
        }

        /* Stats Cards */
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(229, 231, 235, 0.6);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* Utility Classes */
        .gradient-text {
            background: linear-gradient(135deg, #10b981 0%, #047857 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Radio Button Styles */
        .radio-option {
            border: 2px solid #d1d5db;
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }
        .radio-option:hover {
            border-color: #ef4444;
            background-color: #fef2f2;
        }
        .radio-option.selected {
            border-color: #ef4444;
            background-color: #fef2f2;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        .radio-option.selected::after {
            content: '‚úì';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 1.5rem;
            height: 1.5rem;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="admin-grid grid min-h-screen">
        <!-- Sidebar (Desktop) -->
        <aside id="sidebar" class="bg-green-900 p-6 text-white shadow-xl hidden lg:flex lg:flex-col">
            <div class="mb-10 flex items-center space-x-3">
                <div class="relative">
                    <img src="/static/img/logo.png" alt="ETCAR Logo" class="sidebar-logo w-14 h-14">
                    <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full"></div>
                </div>
                <div>
                    <h2 class="text-2xl font-bold">ETCAR</h2>
                    <p class="text-green-200 text-sm">Panel Admin</p>
                </div>
            </div>
            
            <div class="mb-6">
                <p class="text-green-200 text-xs uppercase tracking-wider font-semibold mb-3">Navegaci√≥n</p>
                <nav class="space-y-2 flex-grow">
                    <a href="#" data-section="viewUsers" class="nav-link active flex items-center space-x-3 p-4 rounded-xl hover:bg-green-800 transition-all duration-200">
                        <div class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 016-6h6a6 6 0 016 6v1h-3"></path></svg>
                        </div>
                        <div>
                            <span class="font-medium">Ver Usuarios</span>
                            <p class="text-green-200 text-xs">Gestionar usuarios</p>
                        </div>
                    </a>
                    
                    <a href="#" data-section="registerUser" class="nav-link flex items-center space-x-3 p-4 rounded-xl hover:bg-green-800 transition-all duration-200">
                        <div class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg>
                        </div>
                        <div>
                            <span class="font-medium">Nuevo Usuario</span>
                            <p class="text-green-200 text-xs">Registrar usuario</p>
                        </div>
                    </a>
                    
                    <a href="#" data-section="generatePdf" class="nav-link flex items-center space-x-3 p-4 rounded-xl hover:bg-green-800 transition-all duration-200">
                        <div class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        </div>
                        <div>
                            <span class="font-medium">Reportes PDF</span>
                            <p class="text-green-200 text-xs">Generar documentos</p>
                        </div>
                    </a>
                </nav>
            </div>
            
            <div class="mt-auto pt-6 border-t border-green-700/50">
                <a href="#" id="desktopLogout" class="flex items-center space-x-3 p-3 rounded-xl text-red-300 hover:bg-red-500/20 hover:text-white transition-all duration-200 border border-red-300/20">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    <span class="font-medium">Cerrar Sesi√≥n</span>
                </a>
            </div>
        </aside>

        <!-- Contenido Principal -->
        <main class="main-content p-4 lg:p-8 w-full bg-gray-50/50 min-h-screen">
            <!-- Mobile Welcome Message -->
            <div class="mobile-welcome lg:hidden">
                <div class="flex items-center justify-center space-x-2 mb-2">
                    <img src="/static/img/logo.png" alt="ETCAR Logo" class="w-6 h-6 filter brightness-0 invert">
                    <p class="text-white/90 text-sm font-medium">
                        <span id="mobileGreeting">Bienvenido</span>, <span id="mobileAdminName">{{ username }}</span>
                    </p>
                </div>
                <h1 class="text-lg font-bold">Panel de Administraci√≥n ETCAR</h1>
            </div>

            <!-- Secci√≥n: Ver Usuarios -->
            <div id="viewUsersSection" class="section-content active">
                <!-- Header Mejorado - Solo en Ver Usuarios -->
                <div class="page-header">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <div class="flex items-center space-x-4">   
                            <div>
                                <h1 id="pageTitle" class="text-2xl lg:text-3xl font-bold gradient-text">Ver Usuarios</h1>
                                <p class="text-gray-600 text-sm">Administra y supervisa los usuarios del sistema</p>
                            </div>
                        </div>
                        
                        <!-- Search Container - Solo visible en secci√≥n usuarios -->
                        <div class="search-container relative lg:max-w-sm">
                            <div class="search-mobile relative">
                                <input type="text" id="userSearchInput" placeholder="Filtrar por nombre, email, rol o estado..." class="form-input w-full">
                                <div class="search-icon absolute left-4 top-1/2 transform -translate-y-1/2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- User Info Desktop -->
                        <div class="flex items-center space-x-3">
                            <div>
                                <p class="text-sm text-gray-500" id="desktopGreeting">Buenos d√≠as</p>
                                <p class="font-semibold text-gray-800" id="desktopAdminName">{{ username }}</p>
                            </div>
                            <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center">
                                <span class="text-white font-semibold text-sm">{{ username[0]|upper }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards - Hidden when filtering on mobile -->
                <div id="statsCardsContainer" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 transition-all duration-300">
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Total Usuarios</p>
                                <p class="text-2xl font-bold text-gray-800" id="totalUsers">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 016-6h6a6 6 0 016 6v1h-3"></path></svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Administradores</p>
                                <p class="text-2xl font-bold text-gray-800" id="adminUsers">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Trabajadores</p>
                                <p class="text-2xl font-bold text-gray-800" id="workerUsers">0</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 00-2 2H8a2 2 0 00-2-2V4a2 2 0 012-2h4a2 2 0 012 2z"></path></svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Results Indicator for Mobile -->
                <div id="mobileSearchResults" class="hidden bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl p-4 mb-6 lg:hidden">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            <span class="font-medium">Resultados de b√∫squeda</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span id="searchResultsCount" class="bg-white/20 px-2 py-1 rounded-lg text-sm font-bold">0</span>
                            <button id="clearSearchMobile" class="bg-white/20 hover:bg-white/30 p-1 rounded-lg transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <p class="text-white/80 text-sm mt-2">
                        Mostrando usuarios que coinciden con "<span id="searchTermDisplay" class="font-medium"></span>"
                    </p>
                </div>

                <!-- Tabla de Usuarios -->
                <div class="bg-white rounded-2xl shadow-sm overflow-hidden card-shadow card-hover">
                    <div class="p-6 border-b border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Usuarios Registrados</h3>
                                <p class="text-gray-600 text-sm mt-1">Gestiona todos los usuarios del sistema</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    <span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                                    Activo
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="min-w-full responsive-table">
                            <thead>
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ID</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Nombre</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Email</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Cargo</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody" class="bg-white divide-y divide-gray-100">
                                <!-- Filas de usuarios se insertar√°n aqu√≠ -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="noUsersMessage" class="text-center py-12 hidden">
                        <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
                            <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 016-6h6a6 6 0 016 6v1h-3"></path></svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-800 mb-2">No se encontraron usuarios</h3>
                        <p class="text-gray-600">Intenta ajustar tus criterios de b√∫squeda o registra nuevos usuarios.</p>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n: Registrar Usuario -->
            <div id="registerUserSection" class="section-content hidden">
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white rounded-2xl shadow-sm p-8 card-shadow card-hover">
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-xl mx-auto mb-4 flex items-center justify-center">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">Registrar Nuevo Usuario</h3>
                            <p class="text-gray-600">Completa los datos para crear una nueva cuenta de usuario</p>
                        </div>
                        
                        <form id="registerUserForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="fullName" class="block text-sm font-semibold text-gray-700 mb-2">
                                        <span class="flex items-center">
                                            <svg class="w-4 h-4 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                            Nombre Completo
                                        </span>
                                    </label>
                                    <input type="text" id="fullName" name="fullName" required class="form-input mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>
                                
                                <div>
                                    <label for="role" class="block text-sm font-semibold text-gray-700 mb-2">
                                        <span class="flex items-center">
                                            <svg class="w-4 h-4 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                                            Rol del Usuario
                                        </span>
                                    </label>
                                    <select id="role" name="role" required class="form-input mt-1 block w-full px-4 py-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                        <option value="">Seleccionar rol</option>
                                        <option value="Trabajador">üë∑ Trabajador</option>
                                        <option value="Administrador">üë®‚Äçüíº Administrador</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path></svg>
                                        Correo Electr√≥nico
                                    </span>
                                </label>
                                <input type="email" id="email" name="email" required class="form-input mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="usuario@ejemplo.com">
                            </div>
                            
                            <div>
                                <label for="password" class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                                        Contrase√±a
                                    </span>
                                </label>                                <div class="relative">
                                    <input type="password" id="password" name="password" required class="form-input block w-full px-4 py-3 pr-24 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="M√≠nimo 8 caracteres">
                                    <div class="absolute inset-y-0 right-0 flex items-center">                                        <button type="button" id="generatePasswordBtn" class="pr-2 flex items-center text-gray-400 hover:text-green-600 focus:outline-none transition-colors" title="Generar contrase√±a aleatoria">
                                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                        </button>
                                        <button type="button" id="togglePasswordVisibility" class="pr-4 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none transition-colors" title="Mostrar/ocultar contrase√±a">
                                            <svg id="eyeIcon" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                                            <svg id="eyeSlashIcon" class="h-5 w-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 .925-2.945 3.542-5.33 6.574-6.111M15 12a3 3 0 11-6 0 3 3 0 016 0zm6.908 3.73A9.979 9.979 0 0121.542 12c-1.274-4.057-5.064-7-9.542-7a9.975 9.975 0 00-2.548.397m0 0A11.953 11.953 0 0012 5c4.478 0 8.268 2.943 9.542 7a11.953 11.953 0 01-2.048 3.85M2 2l20 20"></path></svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label for="signature" class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        Firma Digital <span class="text-gray-500 font-normal">(opcional)</span>
                                    </span>
                                </label>
                                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-green-400 transition-colors">
                                    <div class="space-y-1 text-center">
                                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                                        <div class="flex text-sm text-gray-600">
                                            <label for="signature" class="relative cursor-pointer bg-white rounded-md font-medium text-green-600 hover:text-green-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-green-500">
                                                <span>Cargar archivo</span>
                                                <input id="signature" name="signature" type="file" accept="image/*" class="sr-only">
                                            </label>
                                            <p class="pl-1">o arrastrar y soltar</p>
                                        </div>
                                        <p class="text-xs text-gray-500">PNG, JPG, GIF hasta 10MB</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="pt-4">
                                <button type="submit" class="w-full btn-primary font-semibold py-4 px-6 rounded-lg text-base focus:outline-none focus:ring-4 focus:ring-green-500/50 transition-all duration-200">
                                    <span class="flex items-center justify-center">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                        Registrar Usuario
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n: Generar Reportes PDF -->
            <div id="generatePdfSection" class="section-content hidden">
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white rounded-2xl shadow-sm p-8 card-shadow card-hover">
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-xl mx-auto mb-4 flex items-center justify-center">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">Generar Reportes PDF</h3>
                            <p class="text-gray-600">Crear documentos de cronogramas y reportes de actividades</p>
                        </div>
                        
                        <form id="generatePdfForm" class="space-y-6">
                            <div>
                                <label for="pdfUserSelect" class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-2 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                        Seleccionar Usuario
                                    </span>
                                </label>
                                <select id="pdfUserSelect" name="pdfUserSelect" required class="form-input mt-1 block w-full px-4 py-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                    <option value="">Seleccionar usuario para el reporte</option>
                                    <!-- Opciones se cargan din√°micamente -->
                                </select>
                            </div>
                            
                            <div>
                                <label for="pdfReportType" class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-2 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                        Tipo de Reporte
                                    </span>
                                </label>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                    <label class="radio-option cursor-pointer" data-value="cronograma">
                                        <input type="radio" name="pdfReportType" value="cronograma" class="sr-only" required>
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-800">Cronograma</h4>
                                                <p class="text-sm text-gray-600">Planificaci√≥n mensual</p>
                                            </div>
                                        </div>
                                    </label>
                                    
                                    <label class="radio-option cursor-pointer" data-value="actividades">
                                        <input type="radio" name="pdfReportType" value="actividades" class="sr-only">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-800">Actividades</h4>
                                                <p class="text-sm text-gray-600">Reporte detallado</p>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                                <div class="flex items-start">
                                    <svg class="w-5 h-5 text-amber-600 mt-0.5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 3.001-1.742 3.001H4.42c-1.53 0-2.493-1.667-1.743-3.001l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1.75-2.75a.75.75 0 000 1.5h3.5a.75.75 0 000-1.5h-3.5z" clip-rule="evenodd"></path></svg>
                                    <div>
                                        <h4 class="text-sm font-semibold text-amber-800">Informaci√≥n importante</h4>
                                        <p class="text-sm text-amber-700 mt-1">Los PDFs generados incluir√°n campos para las firmas del trabajador y supervisor correspondientes.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="pt-4">
                                <button type="submit" class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-4 px-6 rounded-lg text-base focus:outline-none focus:ring-4 focus:ring-red-500/50 transition-all duration-200 transform hover:-translate-y-1 hover:shadow-lg">
                                    <span class="flex items-center justify-center">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                        Generar Documento PDF
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>    <!-- Modal Detalles de Usuario -->
    <div id="userDetailsModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                    </div>
                    <h4 class="text-xl font-bold text-gray-800">Detalles del Usuario</h4>
                </div>
                <button id="closeUserDetailsModal" class="text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-lg transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="userDetailsContent" class="space-y-6">
                <!-- Contenido din√°mico se insertar√° aqu√≠ -->
            </div>
        </div>
    </div>

    <!-- Modal Confirmaci√≥n Eliminar Usuario -->
    <div id="deleteUserModal" class="modal">
        <div class="modal-content max-w-md">
            <div class="flex items-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center mr-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg>
                </div>
                <div>
                    <h4 class="text-xl font-bold text-gray-800">Confirmar Eliminaci√≥n</h4>
                    <p class="text-gray-600 text-sm">Esta acci√≥n no se puede deshacer</p>
                </div>
            </div>
            
            <div class="mb-6">
                <p class="text-gray-700 mb-2">¬øEst√° seguro de que desea eliminar al usuario:</p>
                <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                    <p class="font-semibold text-red-800" id="deleteUserName">-</p>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="cancelDeleteUser" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg focus:outline-none transition-colors">
                    Cancelar
                </button>
                <button id="confirmDeleteUser" class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg focus:outline-none transition-colors">
                    Eliminar Usuario
                </button>
            </div>
        </div>
    </div>

    <!-- Barra de navegaci√≥n inferior (M√≥vil) -->
    <nav class="fixed bottom-0 left-0 w-full bg-white/98 backdrop-blur-lg border-t border-gray-200/70 flex justify-around items-center py-2 z-50 shadow-2xl lg:hidden">
        <button class="bottom-nav-link flex flex-col items-center justify-center px-2 py-2 text-green-700 font-medium focus:outline-none active transition-all duration-200" data-section="viewUsers">
            <div class="w-8 h-8 flex items-center justify-center rounded-lg mb-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 016-6h6a6 6 0 016 6v1h-3"></path></svg>
            </div>
            <span class="text-xs font-medium">Usuarios</span>
        </button>
        
        <button class="bottom-nav-link flex flex-col items-center justify-center px-2 py-2 text-gray-500 font-medium focus:outline-none transition-all duration-200" data-section="registerUser">
            <div class="w-8 h-8 flex items-center justify-center rounded-lg mb-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg>
            </div>
            <span class="text-xs font-medium">Nuevo</span>
        </button>
        
        <button class="bottom-nav-link flex flex-col items-center justify-center px-2 py-2 text-gray-500 font-medium focus:outline-none transition-all duration-200" data-section="generatePdf">
            <div class="w-8 h-8 flex items-center justify-center rounded-lg mb-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            </div>
            <span class="text-xs font-medium">PDFs</span>
        </button>
        
        <button id="mobileLogout" class="flex flex-col items-center justify-center px-2 py-2 text-red-500 font-medium focus:outline-none transition-all duration-200 hover:bg-red-50 rounded-lg">
            <div class="w-8 h-8 flex items-center justify-center rounded-lg mb-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
            </div>
            <span class="text-xs font-medium">Salir</span>
        </button>
    </nav>

    <script>
        // --- Inyectar el admin_id desde Jinja2 (debe estar en el contexto del backend) ---
        window.ADMIN_ID = parseInt("{{ admin_id|default(0) }}") || 0;
        var ADMIN_ID = window.ADMIN_ID;

        // DOM Elements
        const sections = {
            viewUsers: document.getElementById('viewUsersSection'),
            registerUser: document.getElementById('registerUserSection'),
            generatePdf: document.getElementById('generatePdfSection'),
        };
        const navLinks = document.querySelectorAll('.nav-link');
        const bottomNavLinks = document.querySelectorAll('.bottom-nav-link');
        const usersTableBody = document.getElementById('usersTableBody');
        const userSearchInput = document.getElementById('userSearchInput');
        const registerUserForm = document.getElementById('registerUserForm');
        const generatePdfForm = document.getElementById('generatePdfForm');
        const pdfUserSelect = document.getElementById('pdfUserSelect');
        const userDetailsModal = document.getElementById('userDetailsModal');
        const userDetailsContent = document.getElementById('userDetailsContent');
        const closeUserDetailsModalBtn = document.getElementById('closeUserDetailsModal');
        const pageTitle = document.getElementById('pageTitle');
        const mobileGreeting = document.getElementById('mobileGreeting');
        const mobileUserName = document.getElementById('mobileUserName');
        const desktopLogoutBtn = document.getElementById('desktopLogout');
        const mobileLogoutBtn = document.getElementById('mobileLogout');
        const noUsersMessage = document.getElementById('noUsersMessage');
        const passwordInput = document.getElementById('password');
        const togglePasswordVisibilityButton = document.getElementById('togglePasswordVisibility');
        const eyeIcon = document.getElementById('eyeIcon');
        const eyeSlashIcon = document.getElementById('eyeSlashIcon');

        // Radio Button Functionality for PDF Report Type
        document.addEventListener('DOMContentLoaded', () => {
            const radioOptions = document.querySelectorAll('.radio-option');
            
            radioOptions.forEach(option => {
                const input = option.querySelector('input[type="radio"]');
                
                // Handle click on the label
                option.addEventListener('click', (e) => {
                    // Remove selected class from all options
                    radioOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    
                    // Check the radio input
                    input.checked = true;
                });
                
                // Handle direct input change (keyboard navigation)
                input.addEventListener('change', () => {
                    if (input.checked) {
                        radioOptions.forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                    }
                });
            });
        });

        // Toast Notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const colors = {
                info: 'bg-blue-500',
                success: 'bg-green-600',
                warning: 'bg-yellow-500',
                error: 'bg-red-600'
            };
            toast.className = `fixed top-20 right-4 ${colors[type] || 'bg-gray-700'} text-white px-6 py-3 rounded-lg shadow-xl z-[10000] transform translate-x-full transition-transform duration-300 ease-out flex items-center space-x-3`;
            
            let iconSvg = '';
            if (type === 'success') iconSvg = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>';
            else if (type === 'error') iconSvg = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>';
            
            toast.innerHTML = `${iconSvg}<span>${message}</span>`;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            setTimeout(() => {
                toast.style.transform = 'translateX(200%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // --- NUEVO: Mostrar estad√≠sticas reales de usuarios ---
        async function fetchUserStats() {
            try {
                const res = await fetch('/info_users');
                if (!res.ok) throw new Error('No se pudo obtener la informaci√≥n de usuarios');
                const data = await res.json();
                document.getElementById('totalUsers').textContent = data.users;
                document.getElementById('adminUsers').textContent = data.admins;
                document.getElementById('workerUsers').textContent = data.workes;
            } catch (e) {
                document.getElementById('totalUsers').textContent = '-';
                document.getElementById('adminUsers').textContent = '-';
                document.getElementById('workerUsers').textContent = '-';
            }
        }

        // --- NUEVO: Mostrar saludo con nombre real del admin ---
        function initializeAdminPanel() {
            const hour = new Date().getHours();
            const greeting = hour < 12 ? 'Buenos d√≠as' : hour < 18 ? 'Buenas tardes' : 'Buenas noches';
            // Desktop
            const desktopGreeting = document.getElementById('desktopGreeting');
            if (desktopGreeting) desktopGreeting.textContent = greeting;
            const desktopAdminName = document.getElementById('desktopAdminName');
            if (desktopAdminName) desktopAdminName.textContent = '{{ username }}';
            // Mobile
            const mobileGreeting = document.getElementById('mobileGreeting');
            const mobileAdminName = document.getElementById('mobileAdminName');
            if (mobileGreeting) mobileGreeting.textContent = greeting;
            if (mobileAdminName) mobileAdminName.textContent = '{{ username }}';
            if (!sessionStorage.getItem('adminWelcomeShown')) {
                setTimeout(() => {
                    showToast(`¬°Bienvenido al Panel de Administraci√≥n, {{ username }}!`, 'success');
                    sessionStorage.setItem('adminWelcomeShown', 'true');
                }, 1000);
            }
            fetchUserStats();
        }

        // --- PDF: Listar solo trabajadores en el select y descargar PDF ---
        function populatePdfUserSelect() {
            fetch('/listar_trabajadores')
                .then(res => res.json())
                .then(users => {
                    pdfUserSelect.innerHTML = '<option value="" disabled selected>Seleccione un usuario</option>';
                    users.forEach(user => {
                        pdfUserSelect.innerHTML += `<option value="${user.id}">${user.nombre} (${user.correo})</option>`;
                    });
                });
        }

        // Section Navigation
        async function renderUsersTable() {
            usersTableBody.innerHTML = '';
            try {
                const res = await fetch('/listar_trabajadores');
                if (!res.ok) throw new Error('No se pudo obtener la lista de usuarios');
                const users = await res.json();
                if (!users.length) {
                    noUsersMessage.classList.remove('hidden');
                    return;
                }
                noUsersMessage.classList.add('hidden');
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50/50 transition-all duration-200';
                    row.innerHTML = `
                        <td class="px-6 py-4 text-sm font-medium text-gray-700">${user.id}</td>
                        <td class="px-6 py-4 text-sm font-semibold text-gray-900">${user.nombre}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">${user.correo || ''}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">${user.cargo}</td>                        <td class="px-6 py-4">
                            <div class="flex space-x-2">
                                <button data-userid="${user.id}" class="view-details-btn inline-flex items-center px-3 py-2 text-sm font-medium text-green-600 hover:text-green-800 hover:bg-green-50 rounded-lg transition-colors">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                                    Ver Detalles
                                </button>
                                ${user.cargo !== 'Administrador' ? `
                                <button data-userid="${user.id}" data-username="${user.nombre}" class="delete-user-btn inline-flex items-center px-3 py-2 text-sm font-medium text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-colors">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                    Eliminar
                                </button>
                                ` : ''}
                            </div>
                        </td>
                    `;
                    usersTableBody.appendChild(row);
                });                // Asignar evento a los botones de ver detalles
                document.querySelectorAll('.view-details-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        openUserDetailsModal(parseInt(this.dataset.userid));
                    });
                });
                
                // Asignar evento a los botones de eliminar usuario
                document.querySelectorAll('.delete-user-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        openDeleteUserModal(parseInt(this.dataset.userid), this.dataset.username);
                    });
                });
            } catch (e) {
                noUsersMessage.classList.remove('hidden');
                usersTableBody.innerHTML = '';
            }
        }

        // --- Generar y descargar PDF ---
        generatePdfForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(generatePdfForm);
            const selectedUserId = formData.get('pdfUserSelect');
            const reportType = formData.get('pdfReportType');
            if (!selectedUserId || !reportType) {
                showToast('Por favor complete todos los campos.', 'error');
                return;
            }
            let endpoint = '';
            if (reportType === 'cronograma') {
                endpoint = `/download_cronograma_pdf?user_id=${selectedUserId}&admin_id=${ADMIN_ID}`;
            } else if (reportType === 'actividades') {
                endpoint = `/download_report_pdf?user_id=${selectedUserId}&admin_id=${ADMIN_ID}`;
            } else {
                showToast('Tipo de reporte no v√°lido.', 'error');
                return;
            }
            // Descargar autom√°ticamente el PDF
            fetch(endpoint, { credentials: 'include' })
                .then(res => {
                    if (!res.ok) throw new Error('No se pudo generar el PDF');
                    return res.blob();
                })
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `reporte_${reportType}_${selectedUserId}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    window.URL.revokeObjectURL(url);
                })
                .catch(() => {
                    showToast('Error al generar o descargar el PDF.', 'error');
                });
        });

        function switchSection(sectionName) {
            Object.values(sections).forEach(section => section.classList.remove('active'));
            navLinks.forEach(link => link.classList.remove('active'));
            bottomNavLinks.forEach(link => link.classList.remove('active', 'text-green-700', 'text-white'));

            if (sections[sectionName]) sections[sectionName].classList.add('active');
            
            const activeNavLink = document.querySelector(`.nav-link[data-section="${sectionName}"]`);
            if (activeNavLink) activeNavLink.classList.add('active');
            
            const activeBottomNavLink = document.querySelector(`.bottom-nav-link[data-section="${sectionName}"]`);
            if (activeBottomNavLink) {
                activeBottomNavLink.classList.add('active', 'text-white');
                activeBottomNavLink.classList.remove('text-gray-500');
            }

            // Update sibling bottom nav links color
            bottomNavLinks.forEach(link => {
                if (!link.classList.contains('active')) {
                    link.classList.add('text-gray-500');
                    link.classList.remove('text-green-700', 'text-white');
                }
            });

            // Update titles and descriptions
            const sectionData = {
                'viewUsers': {
                    title: 'Ver Usuarios',
                    description: 'Administra y supervisa los usuarios del sistema',
                    icon: 'M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4'
                },
                'registerUser': {
                    title: 'Nuevo Usuario',
                    description: 'Registra un nuevo usuario en el sistema',
                    icon: 'M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z'
                },
                'generatePdf': {
                    title: 'Reportes PDF',
                    description: 'Generar documentos de cronogramas y actividades',
                    icon: 'M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z'
                }
            };

            const currentSection = sectionData[sectionName];
            if (currentSection) {
                pageTitle.textContent = currentSection.title;
                const descElement = pageTitle.nextElementSibling;
                if (descElement) {
                    descElement.textContent = currentSection.description;
                }
            }
            
            // Show/hide search bar based on section
            const searchContainer = document.querySelector('.search-container');
            if (searchContainer) {
                if (sectionName === 'viewUsers') {
                    searchContainer.classList.remove('hidden');
                    renderUsersTable();
                } else {
                    searchContainer.classList.add('hidden');
                }
            }
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                switchSection(link.dataset.section);
            });
        });
        bottomNavLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                switchSection(link.dataset.section);
            });
        });

        // Enhanced User Search/Filter
        let searchTimeout;
        userSearchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const searchContainer = document.querySelector('.search-container');
            const searchInput = e.target;
            const statsCardsContainer = document.getElementById('statsCardsContainer');
            const mobileSearchResults = document.getElementById('mobileSearchResults');
            const searchResultsCount = document.getElementById('searchResultsCount');
            const searchTermDisplay = document.getElementById('searchTermDisplay');
            const mainContent = document.querySelector('.main-content');
            const usersTableBody = document.getElementById('usersTableBody');
            // Clear previous timeout
            clearTimeout(searchTimeout);

            // Filtrado instant√°neo de la tabla de usuarios
            let visibleCount = 0;
            if (usersTableBody) {
                const rows = usersTableBody.querySelectorAll('tr');
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    const match = text.includes(searchTerm);
                    row.style.display = match ? '' : 'none';
                    if (match) visibleCount++;
                });
            }
            if (searchResultsCount) searchResultsCount.textContent = visibleCount;
            if (searchTermDisplay) searchTermDisplay.textContent = searchTerm;

            // Add visual indicators when filtering
            if (searchTerm.trim() !== '') {
                searchContainer.classList.add('filtering');
                searchInput.classList.add('filtering');
                // For mobile: hide stats cards and show search results indicator
                if (window.innerWidth <= 1024) {
                    mainContent.classList.add('search-active');
                    statsCardsContainer.classList.add('mobile-hidden');
                    mobileSearchResults.classList.remove('hidden');
                }
            } else {
                searchContainer.classList.remove('filtering');
                searchInput.classList.remove('filtering');
                // For mobile: show stats cards and hide search results indicator
                if (window.innerWidth <= 1024) {
                    mainContent.classList.remove('search-active');
                    statsCardsContainer.classList.remove('mobile-hidden');
                    mobileSearchResults.classList.add('hidden');
                }
            }
        });

        const clearSearchMobile = document.getElementById('clearSearchMobile');
        if (clearSearchMobile) {
            clearSearchMobile.addEventListener('click', () => {
                const userSearchInput = document.getElementById('userSearchInput');
                const searchContainer = document.querySelector('.search-container');
                const statsCardsContainer = document.getElementById('statsCardsContainer');
                const mobileSearchResults = document.getElementById('mobileSearchResults');
                const mainContent = document.querySelector('.main-content');
                
                // Clear search input
                userSearchInput.value = '';
                
                // Remove search visual indicators
                searchContainer.classList.remove('filtering');
                userSearchInput.classList.remove('filtering');
                
                // Reset mobile view
                if (window.innerWidth <= 1024) {
                    mainContent.classList.remove('search-active');
                    statsCardsContainer.classList.remove('mobile-hidden');
                    mobileSearchResults.classList.add('hidden');
                }
            });
        }        if (togglePasswordVisibilityButton && passwordInput && eyeIcon && eyeSlashIcon) {
            togglePasswordVisibilityButton.addEventListener('click', () => {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                eyeIcon.classList.toggle('hidden');
                eyeSlashIcon.classList.toggle('hidden');
            });
        }

        // Generar contrase√±a aleatoria
        const generatePasswordBtn = document.getElementById('generatePasswordBtn');
        if (generatePasswordBtn && passwordInput) {
            generatePasswordBtn.addEventListener('click', async () => {
                try {
                    // Deshabilitar bot√≥n temporalmente
                    generatePasswordBtn.disabled = true;
                    generatePasswordBtn.classList.add('opacity-50');
                    
                    const response = await fetch('/gen_random_pass');
                    if (response.ok) {
                        const data = await response.json();
                        passwordInput.value = data.password;
                        
                        // Mostrar la contrase√±a generada temporalmente
                        const currentType = passwordInput.getAttribute('type');
                        if (currentType === 'password') {
                            passwordInput.setAttribute('type', 'text');
                            eyeIcon.classList.add('hidden');
                            eyeSlashIcon.classList.remove('hidden');
                        }
                        
                        // Mostrar notificaci√≥n de √©xito
                        showToast('Contrase√±a generada autom√°ticamente', 'success');
                        
                        // Enfocar el campo para que el usuario vea la contrase√±a
                        passwordInput.focus();
                        passwordInput.select();
                        
                    } else {
                        showToast('Error al generar contrase√±a', 'error');
                    }
                } catch (error) {
                    showToast('Error de conexi√≥n al generar contrase√±a', 'error');
                } finally {
                    // Rehabilitar bot√≥n
                    generatePasswordBtn.disabled = false;
                    generatePasswordBtn.classList.remove('opacity-50');
                }
            });
        }

        registerUserForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(registerUserForm);
            const mappedFormData = new FormData();
            mappedFormData.append('name', formData.get('fullName'));
            mappedFormData.append('rol', formData.get('role'));
            mappedFormData.append('email', formData.get('email'));
            mappedFormData.append('password', formData.get('password'));
            if (formData.get('signature') && formData.get('signature').size > 0) {
                mappedFormData.append('firma', formData.get('signature'));
            }
            try {
                const res = await fetch('/signup', {
                    method: 'POST',
                    body: mappedFormData
                });
                const data = await res.json();
                if (res.ok) {
                    showToast('Usuario registrado exitosamente.', 'success');
                    registerUserForm.reset();
                    switchSection('viewUsers'); // Volver a la lista
                    renderUsersTable(); // Refrescar tabla
                } else {
                    showToast(data.message || 'Error al registrar usuario', 'error');
                }
            } catch (err) {
                showToast('Error de red al registrar usuario', 'error');
            }
        });

        // Generate PDF Form Submission
        generatePdfForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(generatePdfForm);
            const selectedUserId = formData.get('pdfUserSelect');
            const reportType = formData.get('pdfReportType');
            
            if (!selectedUserId || !reportType) {
                showToast('Por favor complete todos los campos.', 'error');
                return;
            }
            showToast(`Simulando generaci√≥n de PDF (${reportType}) para el usuario seleccionado.`, 'info');
            generatePdfForm.reset();
        });
        
        // Logout
        function handleLogout() {
            const confirmModal = document.createElement('div');
            confirmModal.className = 'fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-[10001]';
            confirmModal.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Confirmar Cierre de Sesi√≥n</h3>
                    <p class="text-sm text-gray-600 mb-6">¬øEst√° seguro de que desea cerrar sesi√≥n?</p>
                    <div class="flex justify-end space-x-3">
                        <button id="cancelLogout" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none">Cancelar</button>
                        <button id="confirmLogout" class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md focus:outline-none">Cerrar Sesi√≥n</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmModal);

            document.getElementById('cancelLogout').addEventListener('click', () => confirmModal.remove());
            document.getElementById('confirmLogout').addEventListener('click', async () => {
                showToast('Cerrando sesi√≥n...', 'info');
                try {
                    const res = await fetch('/logout', { method: 'GET', credentials: 'include' });
                    if (res.ok) {
                        setTimeout(() => {
                            window.location.href = '/';
                        }, 1000);
                    } else {
                        showToast('Error al cerrar sesi√≥n', 'error');
                    }
                } catch (err) {
                    showToast('Error de red al cerrar sesi√≥n', 'error');
                }
                confirmModal.remove();
            });
        }
        if(desktopLogoutBtn) desktopLogoutBtn.addEventListener('click', handleLogout);
        if(mobileLogoutBtn) mobileLogoutBtn.addEventListener('click', handleLogout);        // --- Mostrar detalles de usuario con tablas de reportes y cronogramas ---
        async function openUserDetailsModal(userId) {
            userDetailsContent.innerHTML = '<div class="text-center text-gray-500 py-8">Cargando detalles...</div>';
            userDetailsModal.classList.add('active');
            try {
                // Fetch datos usuario, reportes y cronogramas
                const [userRes, reportesRes, cronogramaRes] = await Promise.all([
                    fetch(`/listar_trabajadores`),
                    fetch(`/list_report_user?user_id=${userId}`),
                    fetch(`/list_cronograma_user?user_id=${userId}`)
                ]);
                let userData = null;
                if (userRes.ok) {
                    const users = await userRes.json();
                    userData = users.find(u => u.id === userId);
                }
                let reportes = [];
                if (reportesRes.ok) {
                    const repJson = await reportesRes.json();
                    reportes = repJson.data || [];
                }
                let cronogramas = [];
                if (cronogramaRes.ok) {
                    const croJson = await cronogramaRes.json();
                    cronogramas = croJson.data || [];
                }
                if (!userData) {
                    userDetailsContent.innerHTML = '<div class=\"text-red-600\">Usuario no encontrado.</div>';
                    return;
                }
                // Render tablas con data-label para m√≥vil
                let reportesHtml = '';
                if (reportes.length > 0) {
                    reportesHtml = `<table class=\"responsive-table min-w-full divide-y divide-gray-200 text-xs mb-2\"><thead class=\"bg-gray-50\"><tr>
                        <th class=\"px-4 py-3\">M√°quina</th>
                        <th class=\"px-4 py-3\">Marca/Modelo</th>
                        <th class=\"px-4 py-3\">Ubicaci√≥n</th>
                        <th class=\"px-4 py-3\">Tipo</th>
                        <th class=\"px-4 py-3\">√öltimo Mant.</th>
                        <th class=\"px-4 py-3\">Pr√≥ximo Mant.</th>
                        <th class=\"px-4 py-3\">Observaciones</th>
                    </tr></thead><tbody>`;
                    reportes.forEach(registro => {
                        reportesHtml += `<tr>
                            <td data-label=\"M√°quina\" class=\"px-4 py-3\">${registro.nombre_maquina || ''}</td>
                            <td data-label=\"Marca/Modelo\" class=\"px-4 py-3\">${registro.marca_modelo || ''}</td>
                            <td data-label=\"Ubicaci√≥n\" class=\"px-4 py-3\">${registro.ubicacion || ''}</td>
                            <td data-label=\"Tipo\" class=\"px-4 py-3\">${registro.tipo_mantenimiento || ''}</td>
                            <td data-label=\"√öltimo Mant.\" class=\"px-4 py-3\">${registro.ultimo_mantenimiento ? registro.ultimo_mantenimiento.split('T')[0] : ''}</td>
                            <td data-label=\"Pr√≥ximo Mant.\" class=\"px-4 py-3\">${registro.proximo_mantenimiento ? registro.proximo_mantenimiento.split('T')[0] : ''}</td>
                            <td data-label=\"Observaciones\" class=\"px-4 py-3\">${registro.observacions || ''}</td>
                        </tr>`;
                    });
                    reportesHtml += '</tbody></table>';
                } else {
                    reportesHtml = '<div class=\"text-gray-500 text-sm\">No hay reportes registrados.</div>';
                }
                let cronogramasHtml = '';
                if (cronogramas.length > 0) {
                    cronogramasHtml = `<table class=\"responsive-table min-w-full divide-y divide-gray-200 text-xs mb-2\"><thead class=\"bg-gray-50\"><tr>
                        <th class=\"px-4 py-3\">M√°quina</th>
                        <th class=\"px-4 py-3\">Marca/Modelo</th>
                        <th class=\"px-4 py-3\">Tarea</th>
                        <th class=\"px-4 py-3\">Frecuencia</th>
                        <th class=\"px-4 py-3\">Pr√≥ximo Mant.</th>
                        <th class=\"px-4 py-3\">Estado</th>
                    </tr></thead><tbody>`;
                    cronogramas.forEach(item => {
                        cronogramasHtml += `<tr>
                            <td data-label=\"M√°quina\" class=\"px-4 py-3\">${item.nombre_maquina || ''}</td>
                            <td data-label=\"Marca/Modelo\" class=\"px-4 py-3\">${item.marca_modelo || ''}</td>
                            <td data-label=\"Tarea\" class=\"px-4 py-3\">${item.tarea_mantenimiento || ''}</td>
                            <td data-label=\"Frecuencia\" class=\"px-4 py-3\">${item.frecuencia || ''}</td>
                            <td data-label=\"Pr√≥ximo Mant.\" class=\"px-4 py-3\">${item.prox_mantenimiento ? item.prox_mantenimiento.split('T')[0] : ''}</td>
                            <td data-label=\"Estado\" class=\"px-4 py-3\">${item.estado || ''}</td>
                        </tr>`;
                    });
                    cronogramasHtml += '</tbody></table>';
                } else {
                    cronogramasHtml = '<div class=\"text-gray-500 text-sm\">No hay cronogramas registrados.</div>';
                }
                userDetailsContent.innerHTML = `
                    <div>
                        <h5 class=\"font-semibold text-gray-700 mb-1\">Usuario: ${userData.nombre} (${userData.cargo})</h5>
                        <p class=\"text-sm text-gray-500 mb-2\">Email: ${userData.correo}</p>
                    </div>
                    <div class=\"mt-4\">
                        <h5 class=\"font-semibold text-green-700 mb-1\">Reportes de Mantenimiento</h5>
                        ${reportesHtml}
                    </div>
                    <div class=\"mt-4\">
                        <h5 class=\"font-semibold text-blue-700 mb-1\">Cronogramas de Mantenimiento</h5>
                        ${cronogramasHtml}
                    </div>
                `;
            } catch (err) {
                userDetailsContent.innerHTML = '<div class="text-red-600">Error al cargar detalles del usuario.</div>';
            }
        }

        // --- Modal de confirmaci√≥n para eliminar usuario ---
        const deleteUserModal = document.getElementById('deleteUserModal');
        const deleteUserName = document.getElementById('deleteUserName');
        const cancelDeleteUser = document.getElementById('cancelDeleteUser');
        const confirmDeleteUser = document.getElementById('confirmDeleteUser');
        let userToDelete = null;

        function openDeleteUserModal(userId, userName) {
            userToDelete = { id: userId, name: userName };
            deleteUserName.textContent = userName;
            deleteUserModal.classList.add('active');
        }

        // Cerrar modal de eliminaci√≥n
        if (cancelDeleteUser) {
            cancelDeleteUser.addEventListener('click', () => {
                deleteUserModal.classList.remove('active');
                userToDelete = null;
            });
        }

        // Confirmar eliminaci√≥n
        if (confirmDeleteUser) {
            confirmDeleteUser.addEventListener('click', async () => {
                if (!userToDelete) return;

                try {
                    const response = await fetch(`/workers/${userToDelete.id}`, {
                        method: 'DELETE',
                        credentials: 'include'
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // Mostrar mensaje de √©xito en una esquina
                        showToast(data.message || 'Usuario eliminado correctamente', 'success');
                        // Cerrar modal
                        deleteUserModal.classList.remove('active');
                        // Refrescar tabla y estad√≠sticas
                        renderUsersTable();
                        fetchUserStats();
                    } else {
                        // Mostrar mensaje de error
                        showToast(data.detail || 'Error al eliminar usuario', 'error');
                    }
                } catch (error) {
                    showToast('Error de conexi√≥n al eliminar usuario', 'error');
                }

                userToDelete = null;
            });
        }

        // Cerrar modal al hacer clic fuera
        if (deleteUserModal) {
            deleteUserModal.addEventListener('mousedown', (e) => {
                if (e.target === deleteUserModal) {
                    deleteUserModal.classList.remove('active');
                    userToDelete = null;
                }
            });
        }

        // --- Cierre del modal de detalles de usuario ---
        if (closeUserDetailsModalBtn && userDetailsModal) {
            closeUserDetailsModalBtn.addEventListener('click', () => {
                userDetailsModal.classList.remove('active');
            });
            userDetailsModal.addEventListener('mousedown', (e) => {
                if (e.target === userDetailsModal) {
                    userDetailsModal.classList.remove('active');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeAdminPanel();
            populatePdfUserSelect();
            switchSection('viewUsers'); // Default section
        });
    </script>
</body>
</html>